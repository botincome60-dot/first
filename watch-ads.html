<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡¶π‡¶ú ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ - ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            padding-bottom: 20px;
        }
        .ad-loading {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-600">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-4 fade-in">
        <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-4 text-white mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="font-bold text-lg">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h2>
                    <p class="text-white/80 text-sm">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                </div>
                <i class="fas fa-play-circle text-2xl"></i>
            </div>
        </div>

        <!-- ‡¶è‡¶° ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ -->
        <div class="bg-white rounded-xl p-4 shadow-sm mb-4 text-center">
            <div class="mb-4">
                <h3 class="font-bold text-lg mb-2">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶è‡¶° ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</h3>
                <div class="text-4xl font-bold text-blue-600" id="adsCounter">‡ß¶/‡ßß‡ß¶</div>
                <p class="text-gray-500 text-sm mt-2">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡ßü ‡ßß‡ß¶‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</p>
            </div>
            
            <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                <div id="progressBar" class="bg-green-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>

        <!-- ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶è‡¶∞‡¶ø‡ßü‡¶æ -->
        <div class="bg-white rounded-xl p-4 shadow-sm mb-4">
            <div class="text-center mb-4">
                <i class="fas fa-ad text-yellow-500 text-4xl mb-3"></i>
                <h3 class="font-bold text-lg">‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶° ‡¶è‡¶°</h3>
                <p class="text-gray-600">‡¶è‡¶á ‡¶è‡¶°‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶® <span class="font-bold text-green-600">‡ß©‡ß¶.‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</span></p>
            </div>
            
            <!-- ‡¶è‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶∞‡¶ø‡ßü‡¶æ -->
            <div class="bg-gray-100 rounded-lg p-4 text-center mb-4">
                <div id="adContent">
                    <h4 class="font-bold text-lg mb-2">üé¨ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶° ‡¶è‡¶°</h4>
                    <p class="text-gray-600 mb-3">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    
                    <div class="bg-white p-4 rounded-lg border border-gray-300">
                        <i class="fas fa-video text-blue-500 text-3xl mb-2"></i>
                        <p class="text-sm text-gray-500 mb-3">‡¶è‡¶ï‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶®</p>
                        <p class="text-xs text-gray-400" id="adStatus">‡¶è‡¶° ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§</p>
                    </div>
                </div>
            </div>
            
            <!-- ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶æ‡¶ü‡¶® -->
            <button onclick="showMonetagAd()" id="watchAdBtn" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg mb-3 hover:from-green-600 hover:to-green-700 transition-colors">
                <i class="fas fa-play mr-2"></i>
                ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
            </button>
            
            <div class="text-center">
                <p class="text-gray-500 text-sm" id="rewardStatus">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá</p>
            </div>
        </div>

        <!-- ‡¶§‡¶•‡ßç‡¶Ø -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
            <div class="flex items-start">
                <i class="fas fa-info-circle text-yellow-500 mt-1 mr-2"></i>
                <div>
                    <h4 class="font-semibold text-yellow-700">‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶§‡¶•‡ßç‡¶Ø</h4>
                    <p class="text-yellow-600 text-sm">‚Ä¢ ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ö‡¶ü‡ßã ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá</p>
                    <p class="text-yellow-600 text-sm">‚Ä¢ ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡ßü ‡ßß‡ß¶‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</p>
                    <p class="text-yellow-600 text-sm">‚Ä¢ ‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶§‡ßá ‡ßß‡ß¶-‡ßß‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶∏‡¶Æ‡ßü ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá</p>
                    <p class="text-yellow-600 text-sm">‚Ä¢ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                </div>
            </div>
        </div>

        <!-- ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® -->
        <a href="tasks.html" class="w-full bg-gray-500 text-white py-3 rounded-xl font-bold text-center block mt-4 hover:bg-gray-600 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>
            ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
        </a>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="app.js"></script>

    <script>
        let adsWatched = 0;
        const maxAdsPerHour = 10;
        let isAdLoading = false;

        function initWatchAdsPage() {
            const user = getUserData();
            if (user) {
                adsWatched = user.today_ads || 0;
                updateCounter();
            }
            hideLoading();
        }

        function updateCounter() {
            document.getElementById('adsCounter').textContent = `${adsWatched}/${maxAdsPerHour}`;
            const progress = (adsWatched / maxAdsPerHour) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            if (adsWatched >= maxAdsPerHour) {
                document.getElementById('watchAdBtn').disabled = true;
                document.getElementById('watchAdBtn').classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                document.getElementById('watchAdBtn').classList.add('bg-gray-400', 'cursor-not-allowed');
                document.getElementById('watchAdBtn').innerHTML = '<i class="fas fa-clock mr-2"></i>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑';
            }
        }

        async function showMonetagAd() {
            const user = getUserData();
            if (!user) {
                alert('‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }

            if (user.today_ads >= 10) {
                alert('‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶è‡¶° ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑! ‡ßß ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }

            if (isAdLoading) {
                return;
            }

            isAdLoading = true;
            const watchBtn = document.getElementById('watchAdBtn');
            watchBtn.disabled = true;
            watchBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            watchBtn.classList.add('ad-loading');
            document.getElementById('adStatus').textContent = '‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
            document.getElementById('adStatus').className = 'text-xs text-yellow-600';

            try {
                console.log('Showing ad...');
                
                // Simulate ad watching for 3 seconds
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Complete ad watch
                await updateUserData({ 
                    balance: user.balance + 30,
                    total_income: user.total_income + 30,
                    total_ads: user.total_ads + 1,
                    today_ads: user.today_ads + 1
                });
                
                // Update UI
                adsWatched = user.today_ads + 1;
                updateCounter();
                
                // Success message
                document.getElementById('adStatus').textContent = '‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá';
                document.getElementById('adStatus').className = 'text-xs text-green-600';
                document.getElementById('rewardStatus').textContent = '‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!';
                document.getElementById('rewardStatus').className = 'text-sm text-green-600 font-semibold';
                
                watchBtn.innerHTML = '<i class="fas fa-check mr-2"></i>‡¶∏‡¶´‡¶≤! ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá';
                watchBtn.classList.remove('ad-loading', 'bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                watchBtn.classList.add('bg-green-500');
                
                showNotification('üéâ ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
                
                // Reset button after 3 seconds
                setTimeout(() => {
                    if (adsWatched < maxAdsPerHour) {
                        resetAdButton();
                    }
                    isAdLoading = false;
                }, 3000);
                
            } catch (error) {
                console.error('Ad error:', error);
                document.getElementById('adStatus').textContent = '‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ - ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
                document.getElementById('adStatus').className = 'text-xs text-red-600';
                
                alert('‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                
                resetAdButton();
                isAdLoading = false;
            }
        }

        function resetAdButton() {
            if (adsWatched < maxAdsPerHour) {
                document.getElementById('watchAdBtn').innerHTML = '<i class="fas fa-play mr-2"></i>‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
                document.getElementById('watchAdBtn').classList.remove('bg-green-500', 'ad-loading');
                document.getElementById('watchAdBtn').classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                document.getElementById('watchAdBtn').disabled = false;
                document.getElementById('adStatus').textContent = '‡¶è‡¶° ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§';
                document.getElementById('adStatus').className = 'text-xs text-green-600';
                document.getElementById('rewardStatus').textContent