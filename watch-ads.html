<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡¶π‡¶ú ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ - ‡¶ì‡ßü‡¶æ‡¶ö ‡¶è‡¶°</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            padding-bottom: 20px;
        }
        .ad-loading {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-600">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-4 fade-in">
        <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
        <div class="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-2xl p-4 text-white mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="font-bold text-lg">‡¶ì‡ßü‡¶æ‡¶ö ‡¶è‡¶°</h2>
                    <p class="text-white/80 text-sm">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                </div>
                <i class="fas fa-video text-2xl"></i>
            </div>
        </div>

        <!-- ‡¶ì‡ßü‡¶æ‡¶ö ‡¶è‡¶° ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ -->
        <div class="bg-white rounded-xl p-4 shadow-sm mb-4 text-center">
            <div class="mb-4">
                <h3 class="font-bold text-lg mb-2">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ì‡ßü‡¶æ‡¶ö ‡¶è‡¶° ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</h3>
                <div class="text-4xl font-bold text-blue-600" id="watchAdsCounter">‡ß¶/‡ßß‡ß¶‡ß¶</div>
                <p class="text-gray-500 text-sm mt-2" id="watchAdsResetTimer">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡ßß‡ß¶‡ß¶‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</p>
            </div>
            
            <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                <div id="watchAdsProgressBar" class="bg-blue-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>

        <!-- ‡¶ì‡ßü‡¶æ‡¶ö ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶è‡¶∞‡¶ø‡ßü‡¶æ -->
        <div class="bg-white rounded-xl p-4 shadow-sm mb-4">
            <div class="text-center mb-4">
                <i class="fas fa-video text-blue-500 text-4xl mb-3"></i>
                <h3 class="font-bold text-lg">‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶° ‡¶è‡¶°</h3>
                <p class="text-gray-600">‡¶è‡¶á ‡¶è‡¶°‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶® <span class="font-bold text-green-600">‡ß©‡ß¶.‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</span> ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</p>
            </div>
            
            <!-- ‡¶è‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶∞‡¶ø‡ßü‡¶æ -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center mb-4">
                <div id="watchAdContent">
                    <h4 class="font-bold text-lg mb-2">üé¨ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶° ‡¶è‡¶°</h4>
                    <p class="text-gray-600 mb-3">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶æ‡¶®</p>
                    
                    <div class="bg-white p-4 rounded-lg border border-blue-300">
                        <i class="fas fa-ad text-blue-500 text-3xl mb-2"></i>
                        <p class="text-sm text-gray-500 mb-3">‡¶è‡¶ï‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶æ‡¶®</p>
                        <p class="text-xs text-gray-400" id="watchAdStatus">‡¶è‡¶° ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§</p>
                    </div>
                </div>
            </div>
            
            <!-- ‡¶¨‡¶æ‡¶ü‡¶® -->
            <button onclick="showWatchAd()" id="watchAdBtn" class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white py-4 rounded-xl font-bold text-lg mb-3 hover:from-blue-600 hover:to-cyan-600 transition-colors">
                <i class="fas fa-play mr-2"></i>
                ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
            </button>
            
            <div class="text-center">
                <p class="text-gray-500 text-sm" id="watchRewardStatus">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá</p>
            </div>
        </div>

        <!-- ‡¶§‡¶•‡ßç‡¶Ø -->
        <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
            <div class="flex items-start">
                <i class="fas fa-info-circle text-blue-500 mt-1 mr-2"></i>
                <div>
                    <h4 class="font-semibold text-blue-700">‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶§‡¶•‡ßç‡¶Ø</h4>
                    <p class="text-blue-600 text-sm">‚Ä¢ ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ö‡¶ü‡ßã ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá</p>
                    <p class="text-blue-600 text-sm">‚Ä¢ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡ßß‡ß¶‡ß¶‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</p>
                    <p class="text-blue-600 text-sm">‚Ä¢ ‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶§‡ßá ‡ßß‡ß´-‡ß®‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶∏‡¶Æ‡ßü ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá</p>
                    <p class="text-blue-600 text-sm">‚Ä¢ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    <p class="text-blue-600 text-sm">‚Ä¢ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶Æ‡¶ß‡ßç‡¶Ø‡¶∞‡¶æ‡¶§‡ßá (‡ßß‡ß®:‡ß¶‡ß¶ AM) ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶π‡¶¨‡ßá</p>
                </div>
            </div>
        </div>

        <!-- ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® -->
        <a href="tasks.html" class="w-full bg-gray-500 text-white py-3 rounded-xl font-bold text-center block mt-4 hover:bg-gray-600 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>
            ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
        </a>
    </div>

    <!-- Firebase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app-supabase.js"></script>

    <script>
        let isWatchAdLoading = false;
        let userWatchAdsData = {
            today_watch_ads: 0,
            last_watch_ad_reset: null
        };

        // ‡¶ì‡ßü‡¶æ‡¶ö ‡¶è‡¶° ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ
        const watchAdLinks = [
            "https://medievalkin.com/q3gtdwtif0?key=8fab9c833a59630b50874801fba88f73",
            "https://medievalkin.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://adexora.my.id/dl/uDjmlB4uoO",
            "https://otieu.com/4/9809044",
            "https://otieu.com/4/10095617",
            "https://ferocitysuperintend.com/img7n81xh8?key=60effca0c228e66afd204784027d8b16"
        ];

        function initWatchAdsPage() {
            loadWatchAdsData();
            updateWatchAdsResetTimer();
            hideLoading();
        }

        function loadWatchAdsData() {
            const user = getUserData();
            if (user) {
                userWatchAdsData.today_watch_ads = user.today_watch_ads || 0;
                userWatchAdsData.last_watch_ad_reset = user.last_watch_ad_reset || user.join_date;
                updateWatchAdsCounter();
            }
        }

        function updateWatchAdsCounter() {
            document.getElementById('watchAdsCounter').textContent = `${userWatchAdsData.today_watch_ads}/‡ßß‡ß¶‡ß¶`;
            const progress = (userWatchAdsData.today_watch_ads / 100) * 100;
            document.getElementById('watchAdsProgressBar').style.width = `${progress}%`;
            
            // Check if user can watch more ads
            if (!canWatchMoreAds()) {
                document.getElementById('watchAdBtn').disabled = true;
                document.getElementById('watchAdBtn').classList.remove('bg-gradient-to-r', 'from-blue-500', 'to-cyan-500', 'hover:from-blue-600', 'hover:to-cyan-600');
                document.getElementById('watchAdBtn').classList.add('bg-gray-400', 'cursor-not-allowed');
                document.getElementById('watchAdBtn').innerHTML = '<i class="fas fa-clock mr-2"></i>‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ - ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
            } else {
                document.getElementById('watchAdBtn').disabled = false;
                document.getElementById('watchAdBtn').classList.remove('bg-gray-400', 'cursor-not-allowed');
                document.getElementById('watchAdBtn').classList.add('bg-gradient-to-r', 'from-blue-500', 'to-cyan-500', 'hover:from-blue-600', 'hover:to-cyan-600');
                document.getElementById('watchAdBtn').innerHTML = '<i class="fas fa-play mr-2"></i>‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
            }
        }

        function updateWatchAdsResetTimer() {
            const resetTimer = document.getElementById('watchAdsResetTimer');
            const timeUntilReset = getTimeUntilNextWatchAdReset();
            resetTimer.textContent = `‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡ßß‡ß¶‡ß¶‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® (‡¶∞‡¶ø‡¶∏‡ßá‡¶ü: ${timeUntilReset})`;
        }

        function canWatchMoreAds() {
            const lastReset = new Date(userWatchAdsData.last_watch_ad_reset);
            const now = new Date();
            
            // Check if reset date is today
            const lastResetDate = new Date(lastReset);
            lastResetDate.setHours(0, 0, 0, 0);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // If reset date is not today, user can watch ads
            if (lastResetDate.getTime() < today.getTime()) {
                return true;
            }
            
            // Check if user hasn't reached the daily limit
            return userWatchAdsData.today_watch_ads < 100;
        }

        function getTimeUntilNextWatchAdReset() {
            const now = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const timeDiff = tomorrow - now;
            
            const hours = Math.floor(timeDiff / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            
            return `${hours} ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ${minutes} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü`;
        }

        async function showWatchAd() {
            const user = getUserData();
            if (!user) {
                alert('‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }

            if (!canWatchMoreAds()) {
                alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶è‡¶° ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑! ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }

            if (isWatchAdLoading) {
                return;
            }

            isWatchAdLoading = true;
            const watchBtn = document.getElementById('watchAdBtn');
            watchBtn.disabled = true;
            watchBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            watchBtn.classList.add('ad-loading');
            document.getElementById('watchAdStatus').textContent = '‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
            document.getElementById('watchAdStatus').className = 'text-xs text-yellow-600';

            try {
                await showWatchAdLink();
                
            } catch (error) {
                console.error('‚ùå Watch ad error:', error);
                document.getElementById('watchAdStatus').textContent = '‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ - ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
                document.getElementById('watchAdStatus').className = 'text-xs text-red-600';
                
                alert('‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                
                resetWatchAdButton();
                isWatchAdLoading = false;
            }
        }

        function showWatchAdLink() {
            return new Promise((resolve) => {
                document.getElementById('watchAdStatus').textContent = '‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡ßß‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
                document.getElementById('watchAdStatus').className = 'text-xs text-blue-600';
                
                const watchBtn = document.getElementById('watchAdBtn');
                watchBtn.innerHTML = '<i class="fas fa-eye mr-2"></i>‡¶è‡¶° ‡¶ö‡¶≤‡¶õ‡ßá...';
                
                // Randomly select a link
                const randomIndex = Math.floor(Math.random() * watchAdLinks.length);
                const selectedLink = watchAdLinks[randomIndex];
                
                // Open the link in new tab
                window.open(selectedLink, '_blank');
                
                // Simulate ad watching for 15 seconds
                setTimeout(async () => {
                    await rewardUserForWatchAd();
                    resolve();
                }, 15000);
            });
        }

        async function rewardUserForWatchAd() {
            const user = getUserData();
            if (!user) return;
            
            try {
                // Check if we need to reset watch ads counter
                const lastReset = new Date(userWatchAdsData.last_watch_ad_reset);
                const now = new Date();
                
                const lastResetDate = new Date(lastReset);
                lastResetDate.setHours(0, 0, 0, 0);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let todayWatchAds = userWatchAdsData.today_watch_ads;
                let lastWatchAdReset = userWatchAdsData.last_watch_ad_reset;
                
                // Reset if it's a new day
                if (lastResetDate.getTime() < today.getTime()) {
                    todayWatchAds = 0;
                    lastWatchAdReset = now.toISOString();
                }
                
                // Calculate new balance
                const newBalance = user.balance + 30;
                const newTotalIncome = user.total_income + 30;
                
                // Add reward and update watch ads count
                const { data, error } = await supabase
                    .from('users')
                    .update({ 
                        balance: newBalance,
                        total_income: newTotalIncome,
                        today_watch_ads: todayWatchAds + 1,
                        last_watch_ad_reset: lastWatchAdReset
                    })
                    .eq('user_id', user.user_id);
                
                if (error) {
                    console.error('‚ùå Database update error:', error);
                    throw error;
                }
                
                // Update local user data
                user.balance = newBalance;
                user.total_income = newTotalIncome;
                saveUserData(user);
                
                // Update local watch ads data
                userWatchAdsData.today_watch_ads = todayWatchAds + 1;
                userWatchAdsData.last_watch_ad_reset = lastWatchAdReset;
                
                // Update UI
                updateWatchAdsCounter();
                updateWatchAdsResetTimer();
                
                // Success message
                document.getElementById('watchAdStatus').textContent = '‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá';
                document.getElementById('watchAdStatus').className = 'text-xs text-green-600';
                document.getElementById('watchRewardStatus').textContent = '‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!';
                document.getElementById('watchRewardStatus').className = 'text-sm text-green-600 font-semibold';
                
                const watchBtn = document.getElementById('watchAdBtn');
                watchBtn.innerHTML = '<i class="fas fa-check mr-2"></i>‡¶∏‡¶´‡¶≤! ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá';
                watchBtn.classList.remove('ad-loading', 'bg-gradient-to-r', 'from-blue-500', 'to-cyan-500', 'hover:from-blue-600', 'hover:to-cyan-600');
                watchBtn.classList.add('bg-green-500');
                
                showNotification('üéâ ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§', 'success');
                
                // Reset button after 3 seconds
                setTimeout(() => {
                    if (canWatchMoreAds()) {
                        resetWatchAdButton();
                    }
                    isWatchAdLoading = false;
                }, 3000);
                
            } catch (error) {
                console.error('‚ùå Error rewarding user for watch ad:', error);
                document.getElementById('watchAdStatus').textContent = '‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ - ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
                document.getElementById('watchAdStatus').className = 'text-xs text-red-600';
                throw error;
            }
        }

        function resetWatchAdButton() {
            if (canWatchMoreAds()) {
                const watchBtn = document.getElementById('watchAdBtn');
                watchBtn.innerHTML = '<i class="fas fa-play mr-2"></i>‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
                watchBtn.classList.remove('bg-green-500', 'ad-loading');
                watchBtn.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-cyan-500', 'hover:from-blue-600', 'hover:to-cyan-600');
                watchBtn.disabled = false;
                document.getElementById('watchAdStatus').textContent = '‡¶è‡¶° ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§';
                document.getElementById('watchAdStatus').className = 'text-xs text-green-600';
                document.getElementById('watchRewardStatus').textContent = '‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá';
                document.getElementById('watchRewardStatus').className = 'text-gray-500 text-sm';
            }
        }

        function showNotification(message, type = 'info') {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.showPopup({
                    title: type === 'success' ? '‡¶∏‡¶´‡¶≤!' : '‡¶Æ‡ßá‡¶∏‡ßá‡¶ú',
                    message: message,
                    buttons: [{ type: 'close' }]
                });
            } else {
                alert(message);
            }
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        // Update reset timer every minute
        setInterval(updateWatchAdsResetTimer, 60000);

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initWatchAdsPage, 1000);
        });
    </script>
</body>
</html>