<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>বাডাও এড - প্রিমিয়াম এড সিস্টেম</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 20px;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .dao-icon {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 176, 155, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(0, 176, 155, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 176, 155, 0); }
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .progress-bar {
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            background: linear-gradient(90deg, #00b09b 0%, #96c93d 100%);
            transition: width 0.8s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 176, 155, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 176, 155, 0.6);
        }
        
        .btn-primary:disabled {
            background: #ccc;
            box-shadow: none;
            transform: none;
            cursor: not-allowed;
        }
        
        .countdown {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #00b09b;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success {
            background: rgba(0, 176, 155, 0.1);
            color: #00b09b;
        }
        
        .badge-warning {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }
        
        .badge-danger {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8">
        <!-- Header Section -->
        <div class="glass-card p-6 mb-8">
            <div class="text-center mb-6">
                <div class="dao-icon mb-4">
                    <i class="fas fa-bolt text-white text-2xl"></i>
                </div>
                <h1 class="text-3xl font-bold gradient-text mb-2">প্রিমিয়াম এড সিস্টেম</h1>
                <p class="text-gray-600">প্রিমিয়াম এড দেখে প্রতি এডে ৭ টাকা আয় করুন</p>
            </div>
            
            <!-- Stats Section -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="text-center">
                    <div class="text-2xl font-bold gradient-text mb-1" id="todayEarnings">০.০০</div>
                    <div class="text-sm text-gray-600">আজকের আয়</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold gradient-text mb-1" id="adsWatched">০/৫০</div>
                    <div class="text-sm text-gray-600">এড দেখা</div>
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="flex justify-between mb-2">
                    <span class="text-gray-700 font-medium">আজকের লক্ষ্য</span>
                    <span class="font-bold gradient-text" id="progressText">০%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <!-- Main Ad Section -->
        <div class="glass-card p-6 mb-8">
            <div class="text-center mb-6">
                <i class="fas fa-play-circle text-4xl gradient-text mb-4"></i>
                <h2 class="text-xl font-bold mb-2">প্রিমিয়াম এড</h2>
                <div class="inline-block badge badge-success mb-2">
                    <i class="fas fa-coins mr-1"></i> ৭ টাকা/এড
                </div>
                <p class="text-gray-600 text-sm">একটি এড দেখে ৭ টাকা আয় করুন</p>
            </div>
            
            <!-- Ad Status -->
            <div class="text-center mb-6">
                <div id="adStatus" class="inline-block px-4 py-2 rounded-full bg-green-50 text-green-600 font-medium mb-2">
                    <i class="fas fa-check-circle mr-2"></i>এড প্রস্তুত
                </div>
                <p class="text-sm text-gray-600" id="adStatusText">বাটনে ক্লিক করে এড দেখুন</p>
            </div>
            
            <!-- Countdown Timer -->
            <div class="text-center mb-6" id="countdownContainer" style="display: none;">
                <div class="countdown text-3xl mb-2" id="countdown">১০</div>
                <p class="text-gray-600 text-sm">এড চলছে... অপেক্ষা করুন</p>
            </div>
            
            <!-- Main Button -->
            <button onclick="startBadDaoAd()" id="watchAdBtn" class="btn-primary w-full py-4">
                <i class="fas fa-play mr-2"></i>
                <span id="btnText">প্রিমিয়াম এড দেখুন</span>
            </button>
            
            <!-- Loading Animation -->
            <div class="text-center mt-4" id="loadingAnimation" style="display: none;">
                <div class="inline-block">
                    <i class="fas fa-spinner fa-spin text-green-500 text-xl mr-2"></i>
                    <span class="text-gray-600">এড লোড হচ্ছে...</span>
                </div>
            </div>
        </div>
        
        <!-- Info Section -->
        <div class="glass-card p-6">
            <h3 class="text-lg font-bold mb-4 gradient-text">
                <i class="fas fa-info-circle mr-2"></i>গুরুত্বপূর্ণ তথ্য
            </h3>
            <div class="space-y-3">
                <div class="flex items-start">
                    <i class="fas fa-check text-green-500 mt-1 mr-3"></i>
                    <p class="text-gray-700">প্রতি এড দেখে পাবেন <span class="font-bold text-green-600">৭ টাকা</span></p>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check text-green-500 mt-1 mr-3"></i>
                    <p class="text-gray-700">প্রতিদিন <span class="font-bold">৫০টি</span> এড দেখা যাবে</p>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check text-green-500 mt-1 mr-3"></i>
                    <p class="text-gray-700">এড দেখার পর ১০ সেকেন্ড অপেক্ষা করুন</p>
                </div>
            </div>
        </div>
        
        <!-- Back Button -->
        <a href="tasks.html" class="glass-card p-4 mt-6 block text-center">
            <div class="flex items-center justify-center text-gray-600">
                <i class="fas fa-arrow-left mr-2"></i>
                <span class="font-medium">টাস্ক পেজে ফিরে যান</span>
            </div>
        </a>
    </div>

    <!-- Firebase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app-supabase.js"></script>

    <script>
        // বাডাও এড লিঙ্ক তালিকা
        const BAD_DAO_AD_LINKS = [
            "https://ferocitysuperintend.com/q3gtdwtif0?key=8fab9c833a59630b50874801fba88f73",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://adexora.my.id/dl/uDjmlB4uoO",
            "https://otieu.com/4/9809044",
            "https://otieu.com/4/10095617",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://otieu.com/4/9345167",
            "https://otieu.com/4/9569635",
            "https://adexora.my.id/dl/SNIKX7EQosVmS22",
            "https://adexora.my.id/dl/W2jE21XcdjpjT",
            "https://otieu.com/4/10155431",
            "https://adexora.my.id/dl/FroDWns7Gj",
            "https://otieu.com/4/9550427",
            "https://ferocitysuperintend.com/img7n81xh8?key=60effca0c228e66afd204784027d8b16",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://otieu.com/4/9475514",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://adexora.my.id/dl/SNIKX7EQosVmS22",
            "https://adexora.my.id/dl/SNIKX7EQosVmS22",
            "https://otieu.com/4/10095617",
            "https://adexora.my.id/dl/SNIKX7EQosVmS22",
            "https://adexora.my.id/dl/SNIKX7EQosVmS22",
            "https://otieu.com/4/10095617",
            "https://otieu.com/4/10095617"

        ];

        // App State
        let appState = {
            isAdActive: false,
            todayBadDaoAds: 0,
            todayBadDaoEarnings: 0,
            adWindow: null,
            countdownInterval: null,
            currentCountdown: 10
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadBadDaoData();
        });

        // Load data from localStorage
        function loadBadDaoData() {
            const today = new Date().toDateString();
            
            // Load from localStorage
            const savedDate = localStorage.getItem('badDaoLastDate');
            const savedAds = localStorage.getItem('badDaoTodayAds');
            const savedEarnings = localStorage.getItem('badDaoTodayEarnings');
            
            // Check if date changed
            if (savedDate === today) {
                appState.todayBadDaoAds = parseInt(savedAds) || 0;
                appState.todayBadDaoEarnings = parseFloat(savedEarnings) || 0;
            } else {
                // Reset for new day
                appState.todayBadDaoAds = 0;
                appState.todayBadDaoEarnings = 0;
                localStorage.setItem('badDaoLastDate', today);
                localStorage.setItem('badDaoTodayAds', '0');
                localStorage.setItem('badDaoTodayEarnings', '0');
            }
            
            updateBadDaoUI();
        }

        // Save data to localStorage
        function saveBadDaoData() {
            localStorage.setItem('badDaoTodayAds', appState.todayBadDaoAds.toString());
            localStorage.setItem('badDaoTodayEarnings', appState.todayBadDaoEarnings.toString());
        }

        // Update UI
        function updateBadDaoUI() {
            document.getElementById('todayEarnings').textContent = appState.todayBadDaoEarnings.toFixed(2);
            document.getElementById('adsWatched').textContent = `${appState.todayBadDaoAds}/৫০`;
            
            const progress = (appState.todayBadDaoAds / 50) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${Math.round(progress)}%`;
            
            // Update button state
            const watchBtn = document.getElementById('watchAdBtn');
            if (appState.todayBadDaoAds >= 50) {
                watchBtn.disabled = true;
                watchBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i>আজকের লিমিট শেষ';
                document.getElementById('adStatus').innerHTML = '<i class="fas fa-ban mr-2"></i>লিমিট শেষ';
                document.getElementById('adStatus').className = 'inline-block px-4 py-2 rounded-full bg-red-50 text-red-600 font-medium mb-2';
                document.getElementById('adStatusText').textContent = 'আগামীকাল আবার চেষ্টা করুন';
            } else if (appState.isAdActive) {
                watchBtn.disabled = true;
                watchBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>এড চলছে...';
            } else {
                watchBtn.disabled = false;
                watchBtn.innerHTML = '<i class="fas fa-play mr-2"></i>প্রিমিয়াম এড দেখুন';
            }
        }

        // Start Bad Dao Ad
        async function startBadDaoAd() {
            if (appState.isAdActive || appState.todayBadDaoAds >= 50) return;
            
            const user = getUserData();
            if (!user) {
                alert('ডেটা লোড হয়নি। পেজ রিফ্রেশ করুন।');
                return;
            }
            
            appState.isAdActive = true;
            updateBadDaoUI();
            
            try {
                // Show loading
                showBadDaoLoading();
                
                // Open random ad
                await openBadDaoAd();
                
                // Start countdown
                startBadDaoCountdown();
                
                // After 10 seconds, give reward
                setTimeout(async () => {
                    await giveBadDaoReward();
                    finishBadDaoAd();
                }, 10000);
                
            } catch (error) {
                console.error('❌ Bad Dao Ad error:', error);
                showBadDaoNotification('❌ এড লোড করতে সমস্যা হয়েছে। আবার চেষ্টা করুন।', 'error');
                resetBadDaoAd();
            }
        }

        // Open random Bad Dao Ad
        function openBadDaoAd() {
            return new Promise((resolve) => {
                const randomIndex = Math.floor(Math.random() * BAD_DAO_AD_LINKS.length);
                const selectedLink = BAD_DAO_AD_LINKS[randomIndex];
                
                document.getElementById('adStatus').innerHTML = '<i class="fas fa-external-link-alt mr-2"></i>এড খোলা হচ্ছে...';
                document.getElementById('adStatusText').textContent = 'প্রিমিয়াম এড লোড হচ্ছে...';
                
                // Open ad in new tab
                appState.adWindow = window.open(selectedLink, '_blank');
                
                if (!appState.adWindow) {
                    showBadDaoNotification('⚠️ পপআপ ব্লক করা আছে! দয়া করে পপআপ অন করে আবার চেষ্টা করুন।', 'warning');
                    throw new Error('Popup blocked');
                }
                
                setTimeout(resolve, 1000);
            });
        }

        // Start countdown
        function startBadDaoCountdown() {
            const countdownContainer = document.getElementById('countdownContainer');
            const countdownElement = document.getElementById('countdown');
            
            countdownContainer.style.display = 'block';
            appState.currentCountdown = 10;
            countdownElement.textContent = appState.currentCountdown;
            
            appState.countdownInterval = setInterval(() => {
                appState.currentCountdown--;
                countdownElement.textContent = appState.currentCountdown;
                
                if (appState.currentCountdown <= 0) {
                    clearInterval(appState.countdownInterval);
                    countdownContainer.style.display = 'none';
                }
            }, 1000);
        }

        // Give reward (৭ টাকা)
        async function giveBadDaoReward() {
            const user = getUserData();
            if (!user) return;
            
            try {
                // Update counters
                appState.todayBadDaoAds++;
                appState.todayBadDaoEarnings += 7;
                
                // Save to localStorage
                saveBadDaoData();
                
                // Update in database
                await updateUserData({
                    balance: user.balance + 7,
                    total_income: (user.total_income || 0) + 7,
                    total_ads: (user.total_ads || 0) + 1
                });
                
                updateBadDaoUI();
                
                showBadDaoNotification(`✅ সফল! ৭ টাকা যোগ হয়েছে। মোট আয়: ${appState.todayBadDaoEarnings.toFixed(2)} টাকা`, 'success');
                
            } catch (error) {
                console.error('❌ Error giving Bad Dao reward:', error);
                throw error;
            }
        }

        // Finish ad process
                // Finish ad process
        function finishBadDaoAd() {
            // Ad window বন্ধ করা লাইনটি মুছে দেওয়া হয়েছে
            // এখন ad ট্যাব auto close হবে না
            
            document.getElementById('adStatus').innerHTML = '<i class="fas fa-check-circle mr-2"></i>এড সম্পূর্ণ';
            document.getElementById('adStatusText').textContent = '৭ টাকা আপনার ব্যালেন্সে যোগ হয়েছে!';
            
            setTimeout(() => {
                resetBadDaoAd();
            }, 2000);
        }

        // Reset ad process
        function resetBadDaoAd() {
            appState.isAdActive = false;
            
            if (appState.countdownInterval) {
                clearInterval(appState.countdownInterval);
                appState.countdownInterval = null;
            }
            
            document.getElementById('countdownContainer').style.display = 'none';
            document.getElementById('loadingAnimation').style.display = 'none';
            
            updateBadDaoUI();
        }

        // Show loading
        function showBadDaoLoading() {
            document.getElementById('loadingAnimation').style.display = 'block';
        }

        // Show notification
        function showBadDaoNotification(message, type = 'info') {
            let icon = 'ℹ️';
            if (type === 'success') icon = '✅';
            if (type === 'error') icon = '❌';
            if (type === 'warning') icon = '⚠️';
            
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.showPopup({
                    title: type === 'success' ? 'সফল!' : 
                           type === 'error' ? 'ত্রুটি!' : 
                           type === 'warning' ? 'সতর্কতা!' : 'মেসেজ',
                    message: `${icon} ${message}`,
                    buttons: [{ type: 'close' }]
                });
            } else {
                alert(message);
            }
        }
    </script>
</body>
</html>