<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡¶π‡¶ú ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ - ‡¶π‡ßã‡¶Æ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        body {
            padding-bottom: 70px;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Banner Styles */
        .banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            color: white;
            position: relative;
            animation: slideIn 0.8s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .banner-close {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
        }
        .banner-close:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-600">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-4 fade-in">
        <!-- Banner Section -->
        <div id="welcomeBanner" class="banner">
            <button onclick="closeBanner()" class="banner-close">
                <i class="fas fa-times"></i>
            </button>
            <div class="flex items-start">
                <div class="mr-3">
                    <i class="fas fa-gift text-2xl text-yellow-300"></i>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-1">üéâ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‡¶∏‡¶π‡¶ú ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ‡ßá!</h3>
                    <p class="text-white/90 text-sm leading-relaxed">
                        ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶è‡¶á ‡¶∏‡¶π‡¶ú ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶¨‡¶ü‡ßá ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡ßß‡ß¶‡ß¶‡ß¶ ‡¶•‡ßá‡¶ï‡ßá ‡ß®‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§ ‡¶á‡¶®‡¶∂‡¶æ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶ø‡ßü‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü ‡¶®‡¶æ ‡¶∞‡¶ø‡¶ï‡ßÅ‡ßü‡ßá‡¶∑‡ßç‡¶ü ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡ßß ‡¶•‡ßá‡¶ï‡ßá ‡ß® ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§
                    </p>
                </div>
            </div>
        </div>

        <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-4 text-white mb-4">
            <div class="flex items-center space-x-3 mb-3">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-xl"></i>
                </div>
                <div>
                    <h2 class="font-bold text-lg" id="userName">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h2>
                    <p class="text-white/80 text-sm">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</p>
                </div>
            </div>
            
            <div class="bg-white/10 rounded-xl p-3">
                <p class="text-sm">‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                <h1 class="text-2xl font-bold" id="mainBalance">‡ß¶.‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</h1>
            </div>
        </div>

        <!-- ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ -->
        <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-white rounded-xl p-3 shadow-sm">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶è‡¶°‡¶∏</p>
                        <h3 class="font-bold text-lg" id="todayAds">‡ß¶/‡ßß‡ß¶</h3>
                    </div>
                    <i class="fas fa-eye text-blue-500"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-3 shadow-sm">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</p>
                        <h3 class="font-bold text-lg" id="totalReferrals">‡ß¶</h3>
                    </div>
                    <i class="fas fa-users text-green-500"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-3 shadow-sm">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">‡¶Æ‡ßã‡¶ü ‡¶è‡¶°‡¶∏</p>
                        <h3 class="font-bold text-lg" id="totalAds">‡ß¶</h3>
                    </div>
                    <i class="fas fa-chart-line text-purple-500"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-3 shadow-sm">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">‡¶Æ‡ßã‡¶ü ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</p>
                        <h3 class="font-bold text-lg" id="totalIncome">‡ß¶.‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</h3>
                    </div>
                    <i class="fas fa-wallet text-yellow-500"></i>
                </div>
            </div>
        </div>

        <!-- ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶è‡¶ï‡¶∂‡¶® -->
        <div class="bg-white rounded-xl p-4 shadow-sm mb-4">
            <h3 class="font-bold text-lg mb-3">‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶è‡¶ï‡¶∂‡¶®</h3>
            <div class="grid grid-cols-2 gap-3">
                <a href="tasks.html" class="bg-blue-50 border border-blue-200 rounded-lg p-3 text-center hover:bg-blue-100 transition-colors">
                    <i class="fas fa-tasks text-blue-500 text-xl mb-1"></i>
                    <p class="font-semibold text-blue-700">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                </a>
                <a href="support.html" class="bg-green-50 border border-green-200 rounded-lg p-3 text-center hover:bg-green-100 transition-colors">
                    <i class="fas fa-hand-holding-usd text-green-500 text-xl mb-1"></i>
                    <p class="font-semibold text-green-700">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</p>
                </a>
            </div>
        </div>

        <!-- ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl p-4 text-white">
            <h3 class="font-bold text-lg mb-2">‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <p class="text-white/90 text-sm mb-3">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡ßß‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</p>
            
            <div class="bg-white/10 rounded-lg p-3 mb-3">
                <p class="text-xs mb-1">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï</p>
                <div class="flex items-center justify-between">
                    <code class="text-sm font-mono break-all" id="referralLink">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</code>
                    <button onclick="copyReferralLink()" class="bg-white text-green-600 px-3 py-1 rounded text-sm font-semibold ml-2 whitespace-nowrap hover:bg-gray-100 transition-colors">
                        ‡¶ï‡¶™‡¶ø
                    </button>
                </div>
            </div>
            
            <div class="bg-white/10 rounded-lg p-3">
                <p class="text-sm">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤: <span class="font-bold" id="totalReferrals2">‡ß¶</span> ‡¶ú‡¶®</p>
            </div>
        </div>
    </div>

    <!-- ‡¶¨‡¶ü‡¶Æ ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® -->
    <div class="bottom-nav">
        <div class="grid grid-cols-4 gap-1 p-2">
            <a href="index.html" class="flex flex-col items-center p-2 text-blue-600">
                <i class="fas fa-home mb-1"></i>
                <span class="text-xs">‡¶π‡ßã‡¶Æ</span>
            </a>
            <a href="tasks.html" class="flex flex-col items-center p-2 text-gray-500">
                <i class="fas fa-tasks mb-1"></i>
                <span class="text-xs">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span>
            </a>
            <a href="support.html" class="flex flex-col items-center p-2 text-gray-500">
                <i class="fas fa-headset mb-1"></i>
                <span class="text-xs">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</span>
            </a>
            <a href="profile.html" class="flex flex-col items-center p-2 text-gray-500">
                <i class="fas fa-user mb-1"></i>
                <span class="text-xs">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span>
            </a>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="app.js"></script>

    <script>
        // Banner management functions
        function showWelcomeBanner() {
            const banner = document.getElementById('welcomeBanner');
            const hasSeenBanner = localStorage.getItem('hasSeenWelcomeBanner');
            
            if (!hasSeenBanner) {
                banner.style.display = 'block';
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                localStorage.setItem('hasSeenWelcomeBanner', tomorrow.getTime());
            } else {
                const savedTime = parseInt(hasSeenBanner);
                if (Date.now() > savedTime) {
                    banner.style.display = 'block';
                    const newTomorrow = new Date();
                    newTomorrow.setDate(newTomorrow.getDate() + 1);
                    localStorage.setItem('hasSeenWelcomeBanner', newTomorrow.getTime());
                } else {
                    banner.style.display = 'none';
                }
            }
        }

        function closeBanner() {
            const banner = document.getElementById('welcomeBanner');
            banner.style.display = 'none';
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ DOM loaded, initializing app...");
            
            // Show welcome banner
            setTimeout(showWelcomeBanner, 1000);
            
            // Initialize user data
            setTimeout(initializeUserData, 1000);
        });

        // User data initialization (from app.js)
        async function initializeUserData() {
            console.log("üîÑ Initializing user data...");
            
            try {
                const tg = window.Telegram?.WebApp;
                
                if (tg) {
                    tg.expand();
                    tg.ready();
                    console.log("‚úÖ Telegram Web App initialized");
                }

                const user = getUserData();
                if (user) {
                    updateUI();
                    await loadReferralCount();
                }
                
                hideLoading();
                
            } catch (error) {
                console.error("‚ùå Error initializing user data:", error);
                hideLoading();
            }
        }

        function updateUI() {
            const user = getUserData();
            if (!user) return;
            
            const elements = {
                'userName': user.first_name,
                'mainBalance': user.balance.toFixed(2) + ' ‡¶ü‡¶æ‡¶ï‡¶æ',
                'todayAds': user.today_ads + '/10',
                'totalReferrals': user.total_referrals,
                'totalReferrals2': user.total_referrals,
                'totalAds': user.total_ads,
                'totalIncome': user.total_income.toFixed(2) + ' ‡¶ü‡¶æ‡¶ï‡¶æ',
                'referralLink': generateReferralLink()
            };
            
            for (const [id, value] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            }
        }

        function generateReferralLink() {
            const user = getUserData();
            if (!user) return '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            return `https://t.me/sohojincomebot?startapp=ref${user.id}`;
        }

        async function copyReferralLink() {
            const user = getUserData();
            if (!user) {
                alert('‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }
            
            const refLink = generateReferralLink();
            
            try {
                await navigator.clipboard.writeText(refLink);
                await loadReferralCount();
                
                showNotification(
                    `‚úÖ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!\n\n‡¶≤‡¶ø‡¶ô‡ßç‡¶ï: ${refLink}\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤: ${user.total_referrals} ‡¶ú‡¶®\n\n‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶è‡¶á ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶¶‡¶ø‡¶®, ‡¶∏‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá‡¶á ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶ø ‡ßß‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶¨‡ßá‡¶®!`, 
                    'success'
                );
                
            } catch (error) {
                const tempInput = document.createElement('input');
                tempInput.value = refLink;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                showNotification(
                    `‚úÖ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!\n\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤: ${user.total_referrals} ‡¶ú‡¶®`, 
                    'success'
                );
            }
        }

        async function loadReferralCount() {
            const user = getUserData();
            if (!user) return;
            
            try {
                // Simulate loading referral count
                console.log('üìä Loading referral count...');
                // In real app, this would call Firebase
            } catch (error) {
                console.error("‚ùå Error loading referral count:", error);
            }
        }

        function showNotification(message, type = 'info') {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.showPopup({
                    title: type === 'success' ? '‡¶∏‡¶´‡¶≤!' : '‡¶Æ‡ßá‡¶∏‡ßá‡¶ú',
                    message: message,
                    buttons: [{ type: 'close' }]
                });
            } else {
                alert(message);
            }
        }

        // Mock function for getUserData (from app.js)
        function getUserData() {
            // This is a mock function - in real app it comes from app.js
            return {
                id: '123456789',
                first_name: '‡¶á‡¶â‡¶ú‡¶æ‡¶∞',
                balance: 50.00,
                today_ads: 0,
                total_ads: 0,
                total_referrals: 0,
                total_income: 50.00
            };
        }
    </script>
</body>
</html>